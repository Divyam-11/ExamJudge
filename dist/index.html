<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/4712/4712027.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ExamJudge Assistant</title>
    <script type="module" crossorigin src="/assets/index-CQc1j3ZG.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-lqiRxCl1.css" />
  </head>

  <body>
    <div id="root"></div>

    <!-- üí¨ ExamJudge Chatbot Widget -->
    <div id="chatbot-container">
      <div id="chatbot-button">
        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712027.png" alt="Chat" />
      </div>

      <div id="chatbot-window" class="hidden">
        <div id="chatbot-header">
          <span>ExamJudge Assistant</span>
          <button id="chatbot-close">‚úñ</button>
        </div>

        <div id="chatbot-messages"></div>

        <!-- Quick reply buttons -->
        <div id="chatbot-options">
          <button class="chat-option">üìò Exam Rules</button>
          <button class="chat-option">üßë‚Äçüíª How to Join</button>
          <button class="chat-option">‚ö†Ô∏è Cheating Detection</button>
          <button class="chat-option">üìä Logs Info</button>
        </div>

        <div id="chatbot-input">
          <input type="text" id="chatbot-text" placeholder="Ask about ExamJudge..." />
          <button id="chatbot-send">‚û§</button>
        </div>
      </div>
    </div>

    <style>
      body { font-family: "Poppins", sans-serif; background: #f5f6fa; margin: 0; padding: 0; }

      /* Floating chat icon */
      #chatbot-container { position: fixed; bottom: 25px; right: 25px; z-index: 9999; }
      #chatbot-button {
        background: linear-gradient(135deg, #007bff, #0056d2);
        color: white;
        width: 65px;
        height: 65px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        transition: transform 0.2s ease;
      }
      #chatbot-button:hover { transform: scale(1.1); }
      #chatbot-button img { width: 36px; height: 36px; }

      /* Chat window */
      #chatbot-window {
        width: 360px;
        height: 520px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      #chatbot-window.hidden { display: none; }
      #chatbot-header {
        background: linear-gradient(135deg, #007bff, #0048a7);
        color: #fff;
        padding: 12px 16px;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #chatbot-close {
        background: transparent;
        border: none;
        color: #fff;
        font-size: 18px;
        cursor: pointer;
      }
      #chatbot-messages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        background: #f9fafc;
      }
      .msg { margin-bottom: 10px; padding: 10px 14px; border-radius: 15px; max-width: 80%; font-size: 14px; }
      .user-msg { background: #007bff; color: white; align-self: flex-end; margin-left: auto; }
      .bot-msg { background: #eaeaea; color: #111; align-self: flex-start; margin-right: auto; }

      #chatbot-options {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px;
        border-top: 1px solid #eee;
        background: #fafafa;
      }
      .chat-option {
        background: #007bff;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 6px 12px;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .chat-option:hover { background: #0056d2; }

      #chatbot-input {
        display: flex;
        border-top: 1px solid #ccc;
      }
      #chatbot-text {
        flex: 1;
        padding: 10px;
        border: none;
        outline: none;
        font-size: 14px;
      }
      #chatbot-send {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 14px;
        cursor: pointer;
        font-weight: bold;
      }
    </style>

    <script>
      const chatBtn = document.getElementById("chatbot-button");
      const chatWin = document.getElementById("chatbot-window");
      const closeBtn = document.getElementById("chatbot-close");
      const sendBtn = document.getElementById("chatbot-send");
      const msgBox = document.getElementById("chatbot-messages");
      const textInput = document.getElementById("chatbot-text");
      const optionBtns = document.querySelectorAll(".chat-option");

      chatBtn.onclick = () => { chatWin.classList.remove("hidden"); chatBtn.classList.add("hidden"); };
      closeBtn.onclick = () => { chatWin.classList.add("hidden"); chatBtn.classList.remove("hidden"); };

      function appendMessage(sender, text) {
        const msg = document.createElement("div");
        msg.classList.add("msg", sender === "bot" ? "bot-msg" : "user-msg");
        msg.innerHTML = text;
        msgBox.appendChild(msg);
        msgBox.scrollTop = msgBox.scrollHeight;
      }

      async function sendMessage(message) {
        appendMessage("user", message);
        appendMessage("bot", "‚è≥ Typing...");
        try {
          const response = await fetch("/api/chatbot", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
          });
          const data = await response.json();
          msgBox.lastChild.remove();
          appendMessage("bot", data.reply);
        } catch (e) {
          msgBox.lastChild.remove();
          appendMessage("bot", "‚ö†Ô∏è Error contacting ExamJudge Assistant.");
        }
      }

      sendBtn.onclick = () => {
        const message = textInput.value.trim();
        if (!message) return;
        textInput.value = "";
        sendMessage(message);
      };
      textInput.addEventListener("keypress", (e) => { if (e.key === "Enter") sendBtn.click(); });

      optionBtns.forEach(btn => btn.addEventListener("click", () => sendMessage(btn.textContent)));

      // Welcome
      appendMessage("bot", "üëã Hi! I‚Äôm the ExamJudge Assistant. Ask me about exam setup, rules, or monitoring.");
    </script>
  </body>
</html>
